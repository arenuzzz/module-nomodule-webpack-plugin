{"version":3,"file":"index.js","sources":["../src/lib/util.js","../src/lib/worker-pool.js","../src/plugins/HtmlWebpackEsmodulesPlugin/constants.js","../src/plugins/HtmlWebpackEsmodulesPlugin/utils.js","../src/plugins/HtmlWebpackEsmodulesPlugin/index.js","../src/index.js"],"sourcesContent":["/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Convert a Babel-style SourceMap to Terser-style, parsing if necessary.\n * @param {(import('@babel/core').BabelFileResult)['map']|string|null} map\n * @return {import('source-map').RawSourceMap|null} map\n * @todo This should be deleted, as it's exclusively to make TypeScript happy.\n */\nexport function toTerserMap (map) {\n  if (typeof map === 'string') map = JSON.parse(map);\n  return typeof map === 'object' && map ? {\n    ...map,\n    version: String(map.version)\n  } : null;\n}\n\n/**\n * Convert a Terser-style SourceMap to Babel-style, parsing if necessary.\n * @param {import('source-map').RawSourceMap|string|null} map\n * @returns {(import('@babel/core').BabelFileResult)['map']|null}\n * @todo This should be deleted, as it's exclusively to make TypeScript happy.\n */\nexport function toBabelMap (map) {\n  if (typeof map === 'string') map = JSON.parse(map);\n  return typeof map === 'object' && map ? {\n    file: '',\n    ...map,\n    version: parseInt(map.version, 10)\n  } : null;\n}\n\nconst DEFAULT_COREJS_VERSION = 2;\n\nlet corejsVersion;\n\n/**\n * Get the user's installed version of core-js\n * @returns {number}\n */\nexport function getCorejsVersion () {\n  if (!corejsVersion) {\n    try {\n      // @ts-ignore\n      corejsVersion = parseInt(require('core-js/package.json').version, 10);\n      console.log(`[OptimizePlugin] Detected core-js version ${corejsVersion}`);\n    } catch (e) {\n      console.warn(\n        `[OptimizePlugin] Unable to detect installed version of core-js. Assuming core-js@${DEFAULT_COREJS_VERSION}.`\n      );\n      corejsVersion = DEFAULT_COREJS_VERSION;\n    }\n  }\n  return corejsVersion;\n}\n\nexport function createPerformanceTimings () {\n  const timings = [];\n\n  const start = name => {\n    timings.push({ name, start: Date.now() });\n  };\n\n  const end = name => {\n    for (const entry of timings) {\n      if (entry.name === name) {\n        entry.end = Date.now();\n        entry.duration = entry.end - entry.start;\n        return;\n      }\n    }\n  };\n\n  return {\n    timings,\n    start,\n    end\n  };\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport Worker from 'jest-worker';\n\nexport class WorkerPool {\n  constructor ({ workerPath, concurrency }) {\n    // concurrency = 0;\n    if (concurrency === false || concurrency === 0) {\n      return { enqueue: t => require(workerPath).process(t) };\n    }\n\n    const worker = new Worker(workerPath, {\n      enableWorkerThreads: false,\n      numWorkers: concurrency\n    });\n    let pending = 0;\n    let timer;\n    function check () {\n      clearTimeout(timer);\n      if (--pending === 0) {\n        timer = setTimeout(() => {\n          worker.end();\n        }, 10);\n      }\n    }\n    worker.enqueue = task => {\n      clearTimeout(timer);\n      const p = worker.process(task);\n      pending++;\n      p.then(check);\n      return p;\n    };\n    return worker;\n  }\n}\n\n/*\nimport os from 'os';\nimport Worker from 'jest-worker';\n\nexport class WorkerPool {\n  constructor ({ workerPath, concurrency }) {\n    this.concurrency = Math.max(1, Math.round(concurrency || os.cpus().length || 1));\n    this.runInBand = concurrency === 0 || concurrency === false;\n    this.workerPath = workerPath;\n    this.queue = [];\n    this.workers = [];\n    this.freeWorkers = [];\n  }\n\n  // terminateAll () {\n  //   let worker;\n  //   while ((worker = this.workers.pop())) {\n  //     worker.terminate();\n  //   }\n  // }\n\n  cleanup () {\n    clearTimeout(this.cleanupTimer);\n    const worker = this.getFreeWorker();\n    if (worker) {\n      worker.end();\n      this.cleanupTimer = setTimeout(this.cleanup.bind(this), 100);\n    }\n  }\n\n  getFreeWorker () {\n    return this.freeWorkers.pop();\n  }\n\n  addWorker () {\n    if (this.workers.length >= this.concurrency) return;\n    const worker = this.runInBand ? require(this.workerPath) : new Worker(this.workerPath, {\n      enableWorkerThreads: true,\n      numWorkers: 1\n      // maxRetries: 0\n    });\n    this.workers.push(worker);\n    return worker;\n  }\n\n  enqueue (item) {\n    return new Promise((resolve, reject) => {\n      if (this.queue.push({ item, resolve, reject }) === 1) {\n        this.process();\n      }\n    });\n  }\n\n  async process () {\n    clearTimeout(this.cleanupTimer);\n    if (!this.queue.length) {\n      this.cleanupTimer = setTimeout(this.cleanup.bind(this), 100);\n      return;\n    }\n    const worker = this.getFreeWorker() || this.addWorker();\n    if (!worker) {\n      console.log('queue full');\n      return;\n    }\n    const { item, resolve, reject } = this.queue.pop();\n    try {\n      const result = await worker.process(item);\n      resolve(result);\n    } catch (e) {\n      reject(e);\n    }\n    this.freeWorkers.unshift(worker);\n    this.process();\n  }\n}\n\n// class MockWorkerPool extends WorkerPool {\n//   constructor(options) {\n//     super({\n//       ...options,\n//       concurrency: 1\n//     });\n//   }\n//   getFreeWorker() {\n//     return require(this.workerPath);\n//   }\n// }\n*/\n","export const NAME = 'html-webpack-esmodules-plugin';\n","export const loadScript =\n  'function $f(e,n,o,t,r,i){for(r=0,i=(s=(t=(\"noModule\"in HTMLScriptElement.prototype))?e:n).length;r<i;r++)(o=document.createElement(\"script\")).src=s[r],t?(o.type=\"module\",o.crossOrigin=\"anonymous\"):o.async=!1,document.head.appendChild(o)}';\n\nexport const makeLoadScript = (modernScripts, legacyScripts) => `\n  addEventListener('DOMContentLoaded', function() {\n    ${loadScript}\n    ${`$f(${JSON.stringify(modernScripts)},${JSON.stringify(legacyScripts)})`}\n  })\n`;\n","import DefaultHtmlWebpackPlugin from 'html-webpack-plugin';\nimport * as defaultWebpack from 'webpack';\nimport { NAME } from './constants';\nimport { makeLoadScript } from './utils';\n\nexport default class HtmlWebpackEsmodulesPlugin {\n  constructor(\n    legacy = true,\n    webpack = defaultWebpack,\n    htmlWebpackPlugin = DefaultHtmlWebpackPlugin\n  ) {\n    this.legacy = legacy;\n    this.webpack = webpack;\n    this.htmlWebpackPlugin = htmlWebpackPlugin;\n    this._isWebpack5 = this.webpack.version[0] === '5';\n  }\n\n  apply(compiler) {\n    compiler.hooks.compilation.tap(NAME, (compilation) => {\n      // Support newest and oldest version.\n      if (this.htmlWebpackPlugin.getHooks) {\n        this.htmlWebpackPlugin\n          .getHooks(compilation)\n          .alterAssetTagGroups.tapAsync(\n            {\n              name: NAME,\n              stage: Infinity,\n            },\n            this.alterAssetTagGroups.bind(this, compilation)\n          );\n      } else {\n        compilation.hooks.htmlWebpackPluginAlterAssetTags.tapAsync(\n          { name: NAME, stage: Infinity },\n          this.alterAssetTagGroups.bind(this, compilation)\n        );\n      }\n    });\n  }\n\n  alterAssetTagGroups(\n    compilation,\n    { plugin, bodyTags: body, headTags: head, ...rest },\n    cb\n  ) {\n    // Older webpack compat\n    if (!body) body = rest.body;\n    if (!head) head = rest.head;\n\n    if (this.legacy) {\n      const assets = Object.keys(compilation.assets);\n\n      const legacyMainSrc = assets.find(\n        (src) => src.includes('main') && src.includes('legacy.js')\n      );\n\n      if (!legacyMainSrc) {\n        throw new Error('Legacy script is unavailable');\n      }\n\n      const polyfillSrc = assets.find((src) => src.includes('polyfills'));\n\n      if (polyfillSrc) {\n        head.unshift({\n          tagName: 'script',\n          voidTag: false,\n          meta: { plugin: 'html-webpack-plugin' },\n          attributes: {\n            type: 'nomodule',\n            src: polyfillSrc,\n          },\n        });\n      }\n\n      head.push({\n        tagName: 'script',\n        voidTag: false,\n        meta: { plugin: 'html-webpack-plugin' },\n        attributes: {\n          type: 'nomodule',\n          src: legacyMainSrc,\n        },\n      });\n\n      this.downloadEfficient(head);\n    }\n\n    cb();\n  }\n\n  downloadEfficient(head) {\n    const legacyScriptsSrc = head\n      .filter(\n        (tag) => tag.tagName === 'script' && tag.attributes.type === 'nomodule'\n      )\n      .map((script) => script.attributes.src);\n\n    const modernScriptsSrc = head\n      .filter(\n        (tag) => tag.tagName === 'script' && tag.attributes.type !== 'nomodule'\n      )\n      .map((script) => script.attributes.src);\n\n    head\n      .filter((tag) => tag.tagName === 'script')\n      .forEach((s) => head.splice(head.indexOf(s), 1));\n\n    modernScriptsSrc.forEach((href) =>\n      head.push({\n        tagName: 'link',\n        attributes: { rel: 'modulepreload', href },\n        voidTag: true,\n      })\n    );\n\n    const loadScript = makeLoadScript(modernScriptsSrc, legacyScriptsSrc);\n\n    head.push({ tagName: 'script', innerHTML: loadScript, voidTag: false });\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n * use this file except in compliance with the License. You may obtain a copy of\n * the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n * License for the specific language governing permissions and limitations under\n * the License.\n */\n\nimport util from 'util';\nimport { gzip } from 'zlib';\n// import { promises as fs } from 'fs';\nimport * as defaultWebpack from 'webpack';\nimport { SourceMapSource, RawSource } from 'webpack-sources';\nimport { rollup } from 'rollup';\nimport commonjsPlugin from '@rollup/plugin-commonjs';\nimport nodeResolvePlugin from '@rollup/plugin-node-resolve';\n// import rollupPluginTerserSimple from './lib/rollup-plugin-terser-simple';\n// import rollupPluginStripComments from './lib/rollup-plugin-strip-comments';\nimport { getCorejsVersion, createPerformanceTimings } from './lib/util';\nimport { WorkerPool } from './lib/worker-pool';\n\nimport HtmlWebpackEsmodulesPlugin from './plugins/HtmlWebpackEsmodulesPlugin';\n\nconst NAME = 'OptimizePlugin';\n\nconst DEFAULT_OPTIONS = {\n  /**\n   * Number of Worker Threads to use for running Babel and Terser.\n   * @default os.cpus().length // number of available CPUs\n   */\n  concurrency: undefined,\n\n  /**\n   * Produce Source Maps?\n   * @default false\n   */\n  sourceMap: false,\n\n  /**\n   * Minify bundles using Terser?\n   * @default false\n   */\n  minify: false,\n\n  /**\n   * Produce a set of bundles catering to older browsers alongside the default modern bundles.\n   * @default true\n   */\n  downlevel: true,\n\n  /**\n   * Attempt to upgrade ES5 syntax to equivalent modern syntax.\n   * @default false\n   */\n  modernize: false,\n\n  /**\n   * Show logs containing performance information and inlined polyfill.\n   */\n  verbose: true,\n\n  // /**\n  //  * @default \"polyfills.legacy.js\"\n  //  */\n  // polyfillsFilename: 'polyfills.legacy.js',\n\n  /**\n   * RegExp patterns of assets to exclude\n   * @default []\n   */\n  exclude: []\n};\n\nexport default class OptimizePlugin {\n  /**\n   * @param {Partial<DEFAULT_OPTIONS>?} [options]\n   */\n  constructor(options, webpack = defaultWebpack, htmlWebpackPlugin) {\n    this.webpack = webpack;\n    this.htmlWebpackPlugin = htmlWebpackPlugin;\n    this.options = Object.assign({}, options || {});\n    for (const i in DEFAULT_OPTIONS) {\n      if (this.options[i] == null) this.options[i] = DEFAULT_OPTIONS[i];\n    }\n\n    // const { concurrency } = options;\n    // const workerPath = require.resolve('./worker');\n    // if (concurrency === 0 || concurrency === false) {\n    //   this.workerPool = new MockWorkerPool({ workerPath });\n    // }\n    // else {\n    //   this.workerPool = new WorkerPool({ workerPath, concurrency });\n    // }\n\n    this.rollupCache = {\n      modules: []\n    };\n\n    /** @type {Map<string, Promise<import('rollup').OutputChunk>>} */\n    this.polyfillsCache = new Map();\n  }\n\n  isWebpack4() {\n    return this.webpack.version[0] === '4';\n  }\n\n  isWebpack5() {\n    return this.webpack.version[0] === '5';\n  }\n\n  serializeOptions() {\n    return (\n      this._serialized || (this._serialized = JSON.stringify(this.options))\n    );\n  }\n\n  async optimize(compiler, compilation, chunkFiles) {\n    const cwd = compiler.context;\n    const { timings, start, end } = createPerformanceTimings();\n\n    const options = {\n      corejsVersion: getCorejsVersion(),\n      minify: this.options.minify,\n      downlevel: this.options.downlevel,\n      modernize: this.options.modernize,\n      timings: this.options.verbose\n    };\n\n    const processing = new WeakMap();\n    const chunkAssets = Array.from(compilation.additionalChunkAssets || []);\n\n    const files = [...chunkFiles, ...chunkAssets].filter((asset) => {\n      for (const pattern of this.options.exclude) {\n        if (pattern.test(asset)) {\n          return false;\n        }\n      }\n      return true;\n    });\n\n    start('Optimize Assets');\n    let transformed;\n    try {\n      transformed = await Promise.all(\n        files.map(async (file) => {\n          // ignore non-JS files\n          if (!file.match(/\\.m?[jt]sx?$/i)) return undefined;\n          const asset = compilation.assets[file];\n          let pending = processing.get(asset);\n          if (pending) return pending;\n\n          let source, map;\n          if (this.options.sourceMap && asset.sourceAndMap) {\n            ({ source, map } = asset.sourceAndMap());\n          } else {\n            source = asset.source();\n          }\n\n          const original = {\n            file,\n            source,\n            map,\n            options\n          };\n\n          // // @ts-ignore-next\n          const result = this.workerPool.enqueue(original);\n          pending = result\n            .then(this.buildResultSources.bind(this, original))\n            .catch(console.error);\n          processing.set(asset, pending);\n\n          const t = ` └ ${file}`;\n          start(t);\n          result.then((r) => {\n            for (const entry of r.timings) {\n              // entry.name = '    ' + entry.name;\n              entry.depth = 2;\n              timings.push(entry);\n            }\n            end(t);\n          });\n\n          return pending;\n        })\n      );\n    } catch (e) {\n      console.log('errored out during transformation ', e);\n      throw e;\n    }\n\n    end('Optimize Assets');\n\n    const allPolyfills = new Set();\n\n    const polyfillReasons = new Map();\n\n    transformed.filter(Boolean).forEach(\n      ({\n        file,\n        modern,\n        legacyFile,\n        legacy\n        // polyfills\n      }) => {\n        // const polyfills = [];\n        const polyfills = this.options.polyfill ? [this.options.polyfill] : [];\n        for (const p of polyfills) {\n          allPolyfills.add(p);\n          let reasons = polyfillReasons.get(p);\n          if (!reasons) polyfillReasons.set(p, (reasons = []));\n          reasons.push(legacyFile);\n        }\n        compilation.assets[file] = modern;\n        if (legacy) {\n          compilation.assets[legacyFile] = legacy;\n        }\n      }\n    );\n\n    const polyfills = Array.from(allPolyfills);\n    let polyfillsAsset;\n\n    if (polyfills.length) {\n      start('Bundle Polyfills');\n      polyfillsAsset = await this.generatePolyfillsChunkCached(\n        polyfills,\n        cwd,\n        timings\n      );\n\n      compilation.assets[polyfillsAsset._name] = polyfillsAsset;\n      end('Bundle Polyfills');\n    }\n\n    timings.sort((t1, t2) => t1.start - t2.start);\n    if (this.options.verbose) {\n      await this.showOutputSummary(\n        timings,\n        polyfills,\n        polyfillReasons,\n        polyfillsAsset\n      );\n    }\n  }\n\n  async generatePolyfillsChunkCached(polyfills, cwd, timings) {\n    const polyfillsKey = polyfills.join('\\n');\n\n    let generatePolyfills = this.polyfillsCache.get(polyfillsKey);\n    if (!generatePolyfills) {\n      generatePolyfills = this.generatePolyfillsChunk(polyfills, cwd, timings);\n      this.polyfillsCache.set(polyfillsKey, generatePolyfills);\n    }\n\n    const output = await generatePolyfills;\n\n    return new SourceMapSource(\n      output.code,\n      output.fileName,\n      // @ts-ignore\n      output.map\n    );\n  }\n\n  /**\n   * @todo Write cached polyfills chunk to disk\n   */\n  async generatePolyfillsChunk(polyfills, cwd, timings) {\n    const ENTRY = '\\0entry';\n\n    const entryContent = polyfills.reduce(\n      (str, p) => `${str}\\nimport \"${p.replace('.js', '')}\";`,\n      ''\n    );\n\n    const COREJS = require\n      .resolve('core-js/package.json')\n      .replace('package.json', '');\n    const isCoreJsPath = /(?:^|\\/)core-js\\/(.+)$/;\n    const nonCoreJsPolyfills = polyfills.filter(\n      (p) => !/(core-js|regenerator-runtime)/.test(p)\n    );\n\n    if (timings && nonCoreJsPolyfills.length) {\n      console.log(\n        `  Bundling ${nonCoreJsPolyfills.length} unrecognized polyfills.`\n      );\n    }\n\n    const polyfillsBundle = await rollup({\n      // cache: this.rollupCache,\n      context: 'window',\n\n      // perf: !!timings,\n      input: polyfills[0],\n      treeshake: {\n        propertyReadSideEffects: false,\n        tryCatchDeoptimization: false,\n        unknownGlobalSideEffects: false\n      },\n      plugins: [\n        // {\n        //   name: 'entry',\n        //   resolveId: (id) => (id === ENTRY ? id : null),\n        //   load: (id) => (id === ENTRY ? entryContent : null),\n        // },\n        // {\n        //   name: 'core-js',\n        //   resolveId(id) {\n        //     if (/^regenerator-runtime(\\/|$)/.test(id)) {\n        //       return require.resolve('regenerator-runtime/runtime');\n        //     }\n        //     const m = id.match(isCoreJsPath);\n        //     if (m && !/\\.js$/.test(id)) {\n        //       return COREJS + m[1] + '.js';\n        //     }\n        //     return null;\n        //   },\n        // load(id) {\n        //   const m = id.match(isCoreJsPath);\n        //   if (m && id.indexOf('?') === -1) {\n        //     return fs.readFile(COREJS + m[1], 'utf-8');\n        //   }\n        //   return null;\n        // },\n        // },\n        // coreJsPlugin(),\n        commonjsPlugin({\n          // ignoreGlobal: true,\n          sourceMap: false\n        }),\n        // nonCoreJsPolyfills.length &&\n        nodeResolvePlugin({\n          browser: true\n          // dedupe: nonCoreJsPolyfills,\n          // only: nonCoreJsPolyfills,\n          // preferBuiltins: false,\n        }),\n        {\n          name: 'babel',\n          renderChunk(source) {\n            return require('@babel/core').transformAsync(source, {\n              sourceMaps: true,\n              // minified: true,\n              shouldPrintComment: () => false,\n              presets: [\n                [\n                  require('@babel/preset-env'),\n                  {\n                    loose: true,\n                    modules: false,\n                    corejs: 3,\n                    useBuiltIns: 'entry'\n                  }\n                ]\n              ]\n            });\n          }\n        }\n        // this.options.minify\n        //   ? rollupPluginTerserSimple()\n        //   : rollupPluginStripComments(),\n      ].filter(Boolean)\n    });\n    // this.setRollupCache(polyfillsBundle.cache);\n\n    const result = await polyfillsBundle.generate({\n      entryFileNames: 'static/js/polyfills.[hash].js',\n      exports: 'none',\n      externalLiveBindings: false,\n      freeze: false,\n      compact: true,\n      format: 'iife',\n      sourcemap: false,\n      strict: false\n    });\n\n    const output = result.output[0];\n\n    // If verbose logging is enabled, bubble up some useful Rollup time information\n    // if (timings) {\n    //   const times = polyfillsBundle.getTimings();\n    //   const add = (name, timing) => {\n    //     const t = times[timing];\n    //     if (t) timings.push({ depth: 2, name, duration: t[0] });\n    //   };\n    //   add('parse', '## parse modules');\n    //   add('node-resolve', '- plugin 2 (node-resolve) - resolveId (async)');\n    //   add('generate', '# GENERATE');\n    // }\n\n    return output;\n  }\n\n  // yes I did this to fix TS inference\n  setRollupCache(cache) {\n    this.rollupCache = cache;\n  }\n\n  /** @todo move to helper file */\n  async showOutputSummary(timings, polyfills, polyfillReasons, polyfillsAsset) {\n    let totalTime = 0;\n    let timingsStr = '';\n    for (const entry of timings) {\n      totalTime += entry.duration;\n      // timingsStr += `\\n  ${('      ' + (entry.duration || '- ')).substr(-6)}ms: ${entry.name}`;\n      timingsStr += `\\n  ${new Array(entry.depth || 1).join('      ')}${String(\n        entry.duration | 0 || '- '\n      ).padStart(6, ' ')}ms: ${entry.name}`;\n    }\n\n    polyfills = polyfills.map((polyfill) => {\n      const reasons = polyfillReasons.get(polyfill);\n      return { polyfill, reasons, reasonsKey: reasons.join('\\n') };\n    });\n    polyfills.sort((p1, p2) => p1.reasonsKey.localeCompare(p2.reasonsKey));\n\n    const serializeReasons = (reasons) => {\n      if (reasons.length === 1) return reasons[0];\n      if (reasons.length > 3) {\n        return `${reasons[0]}, ${reasons[1]} and ${reasons.length - 2} others`;\n      }\n      reasons = reasons.slice();\n      const last = reasons.pop();\n      return reasons.join(', ') + ' and ' + last;\n    };\n\n    let lastReasonsKey;\n    let polyfillsStr = polyfills.reduce(\n      (str, { polyfill, reasons, reasonsKey }) => {\n        if (reasonsKey !== lastReasonsKey) {\n          str = str.replace(/├.*?$/, '└');\n          str += `\\n└ Used by ${serializeReasons(reasons)}:`;\n          lastReasonsKey = reasonsKey;\n        }\n        str += `\\n  ├ ${polyfill}`;\n        return str;\n      },\n      ''\n    );\n    polyfillsStr = polyfillsStr.replace(/├(.*?)$/, '└$1');\n\n    const preamble = `[${NAME}] Completed in ${\n      totalTime | 0\n    }ms.${timingsStr}\\n`;\n\n    if (!polyfillsAsset) {\n      console.log(preamble + 'No polyfills bundle was created.');\n      return;\n    }\n\n    const polyfillsSize = polyfillsAsset\n      ? (await util.promisify(gzip)(polyfillsAsset.source())).byteLength\n      : 0;\n    const polyfillsSizeStr = (polyfillsSize / 1000).toPrecision(3) + 'kB';\n\n    console.log(\n      preamble +\n        `${polyfillsAsset._name} is ${polyfillsSizeStr} and bundles ${polyfills.length} polyfills:${polyfillsStr}`\n    );\n  }\n\n  toFilename(file, variant) {\n    let out = file.replace(/(\\.m?[jt]sx?)$/g, `.${variant}$1`);\n\n    if (out === file) {\n      out += `.${variant}.js`;\n    }\n\n    return out;\n  }\n\n  buildResultSources(original, result) {\n    const file = original.file;\n    const modernFile = file;\n    const modern = this.buildFile(original, result.modern, modernFile);\n    let legacy, legacyFile;\n    if (result.legacy) {\n      legacyFile = this.toFilename(file, 'legacy');\n      legacy = this.buildFile(original, result.legacy, legacyFile);\n    }\n\n    return {\n      original,\n      file,\n      legacyFile,\n      modern,\n      legacy,\n      polyfills: result.polyfills\n    };\n  }\n\n  buildFile(original, result, name) {\n    if (result.map) {\n      return new SourceMapSource(\n        result.source,\n        name || original.file,\n        result.map,\n        original.source,\n        original.map\n      );\n    }\n    // @todo use LineToLineMappedSource as the fallback?\n    return new RawSource(result.source);\n  }\n\n  // modify chunkHash (webpack 4 & 5)\n  updateChunkHash(compilation) {\n    const updateWithHash = (chunk, hash) => {\n      hash.update(NAME);\n      hash.update(this.serializeOptions());\n    };\n\n    if (this.isWebpack4()) {\n      compilation.mainTemplate.hooks.hashForChunk.tap(\n        NAME,\n        updateWithHash.bind(null, null)\n      );\n      compilation.chunkTemplate.hooks.hashForChunk.tap(\n        NAME,\n        updateWithHash.bind(null, null)\n      );\n    } else {\n      // @ts-ignore\n      this.webpack.javascript.JavascriptModulesPlugin.getCompilationHooks(\n        compilation\n      ).chunkHash.tap(NAME, updateWithHash);\n    }\n  }\n\n  apply(compiler) {\n    this.workerPool = new WorkerPool({\n      workerPath: require.resolve('./worker'),\n      concurrency: this.options.concurrency\n    });\n\n    compiler.hooks.compilation.tap(NAME, (compilation) => {\n      if (this.isWebpack5()) {\n        compilation.hooks.processAssets.tapPromise(\n          {\n            name: NAME,\n            stage: this.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE\n          },\n          (assets) => {\n            const chunkFiles = Object.keys(assets);\n            return this.optimize(compiler, compilation, chunkFiles);\n          }\n        );\n      } else {\n        compilation.hooks.optimizeChunkAssets.tapPromise(NAME, (chunks) => {\n          const chunkFiles = Array.from(chunks).reduce(\n            (acc, chunk) => acc.concat(Array.from(chunk.files || [])),\n            []\n          );\n          return this.optimize(compiler, compilation, chunkFiles);\n        });\n      }\n    });\n\n    new HtmlWebpackEsmodulesPlugin(\n      this.options.downlevel,\n      this.webpack,\n      this.htmlWebpackPlugin\n    ).apply(compiler);\n  }\n}\n"],"names":["DEFAULT_COREJS_VERSION","corejsVersion","getCorejsVersion","parseInt","require","version","console","log","e","warn","createPerformanceTimings","timings","start","name","push","Date","now","end","entry","duration","WorkerPool","constructor","workerPath","concurrency","enqueue","t","process","worker","Worker","enableWorkerThreads","numWorkers","pending","timer","check","clearTimeout","setTimeout","task","p","then","NAME","loadScript","makeLoadScript","modernScripts","legacyScripts","JSON","stringify","HtmlWebpackEsmodulesPlugin","legacy","webpack","defaultWebpack","htmlWebpackPlugin","DefaultHtmlWebpackPlugin","_isWebpack5","apply","compiler","hooks","compilation","tap","getHooks","alterAssetTagGroups","tapAsync","stage","Infinity","bind","htmlWebpackPluginAlterAssetTags","plugin","bodyTags","body","headTags","head","rest","cb","assets","Object","keys","legacyMainSrc","find","src","includes","Error","polyfillSrc","unshift","tagName","voidTag","meta","attributes","type","downloadEfficient","legacyScriptsSrc","filter","tag","map","script","modernScriptsSrc","forEach","s","splice","indexOf","href","rel","innerHTML","DEFAULT_OPTIONS","undefined","sourceMap","minify","downlevel","modernize","verbose","exclude","OptimizePlugin","options","assign","i","rollupCache","modules","polyfillsCache","Map","isWebpack4","isWebpack5","serializeOptions","_serialized","optimize","chunkFiles","cwd","context","processing","WeakMap","chunkAssets","Array","from","additionalChunkAssets","files","asset","pattern","test","transformed","Promise","all","file","match","get","source","sourceAndMap","original","result","workerPool","buildResultSources","catch","error","set","r","depth","allPolyfills","Set","polyfillReasons","Boolean","modern","legacyFile","polyfills","polyfill","add","reasons","polyfillsAsset","length","generatePolyfillsChunkCached","_name","sort","t1","t2","showOutputSummary","polyfillsKey","join","generatePolyfills","generatePolyfillsChunk","output","SourceMapSource","code","fileName","reduce","str","replace","resolve","nonCoreJsPolyfills","polyfillsBundle","rollup","input","treeshake","propertyReadSideEffects","tryCatchDeoptimization","unknownGlobalSideEffects","plugins","commonjsPlugin","nodeResolvePlugin","browser","renderChunk","transformAsync","sourceMaps","shouldPrintComment","presets","loose","corejs","useBuiltIns","generate","entryFileNames","exports","externalLiveBindings","freeze","compact","format","sourcemap","strict","setRollupCache","cache","totalTime","timingsStr","String","padStart","reasonsKey","p1","p2","localeCompare","serializeReasons","slice","last","pop","lastReasonsKey","polyfillsStr","preamble","polyfillsSize","util","promisify","gzip","byteLength","polyfillsSizeStr","toPrecision","toFilename","variant","out","modernFile","buildFile","RawSource","updateChunkHash","updateWithHash","chunk","hash","update","mainTemplate","hashForChunk","chunkTemplate","javascript","JavascriptModulesPlugin","getCompilationHooks","chunkHash","processAssets","tapPromise","Compilation","PROCESS_ASSETS_STAGE_OPTIMIZE","optimizeChunkAssets","chunks","acc","concat"],"mappings":"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"}